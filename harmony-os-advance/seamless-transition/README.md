# 数据和文件-分布式邮件

## 流转

在HarmonyOS中泛指跨多设备的分布式操作。流转能力打破设备界限，多设备联动，使用户应用程序可分可合、可流转，实现如邮件跨设备编辑、多设备协同健身、多屏游戏等分布式业务。流转为开发者提供更广的使用场景和更新的产品视角，强化产品优势，实现体验升级。流转按照使用场景可分为跨端迁移和多端协同。

### 跨端迁移

在用户使用设备的过程中，当使用情境发生变化时（例如从室内走到户外或者周围有更合适的设备等），之前使用的设备可能已经不适合继续当前的任务，此时，用户可以选择新的设备来继续当前的任务，原设备可按需决定是否退出任务，这就是跨端迁移场景。

常见的跨端迁移场景实例：在平板上播放的视频，迁移到智慧屏继续播放，从而获得更佳的观看体验；平板上的视频应用退出。

在应用开发层面，跨端迁移指在A端运行的UIAbility迁移到B端上，完成迁移后，B端UIAbility继续任务，而A端UIAbility可按需决定是否退出。

### 多端协同

用户拥有的多个设备，可以作为一个整体，为用户提供比单设备更加高效、沉浸的体验，这就是多端协同场景。

常见的多端协同场景实例：

场景一：两台设备A和B打开备忘录同一篇笔记进行双端协同编辑，在设备A上可以使用本地图库中的图片资源插入编辑，设备B上进行文字内容编辑。

场景二：设备A上正在和客户进行聊天，客户需要的资料在设备B上，可以通过聊天软件打开设备B上的文档应用选择到想要的资料回传到设备A上，然后通过聊天软件发送给客户。

在应用开发层面，多端协同指多端上的不同UIAbility/ServiceExtensionAbility同时运行、或者交替运行实现完整的业务；或者多端上的相同UIAbility/ServiceExtensionAbility同时运行实现完整的业务。

### 简介

本示例基于应用接续、分布式数据对象、分布式文件系统等功能，实现分布式邮件应用。主要包含以下功能：

1. 通过分布式数据对象跨设备传输数据。
2. 通过点击系统Dock栏，使应用接续并进行数据传输。
3. 使用分布式文件系统跨设备传输文件。

![ShoppingApps](screenshots/device/DistributedMail.gif)

### 相关权限
在实现迁移接口前，需要在entry > src > main > module.json5中配置continuable标签：true
表示支持迁移，false表示不支持，默认为false。配置为false，将被系统识别为无法迁移。

### 使用说明

1. 进入应用首页，可以在收件人、发件人、主题文本框输入相应内容。
2. 本端打开分布式邮件应用，对端设备的Dock栏中会新增分布式邮件应用图标，点击分布式邮件应用，本端应用会接续到对端设备上去。

### 流程
在EntryAbility.ets中通过onContinue()接口实现数据传递，将数据传输到对端设备。使用wantParam传输sessionId。使用分布式数据对象传输基础数据。
对于文件数据，则需要将分布式文件目录下的文件转换为资产commonType.Asset类型，再封装到分布式数据对象中进行传输。

使用wantParam传输数据，需要通过onCreate()或onNewWant()接口加载数据。使用分布式数据对象传输数据，需要创建空的分布式数据对象，用于接收恢复的数据。
对于文件数据，则需要创建资产commonType.Asset类型对象，用于接收文件信息。

### 约束与限制

1. 本示例仅支持标准系统上运行，支持设备：华为手机。
2. HarmonyOS系统：HarmonyOS NEXT Developer Beta5及以上。
3. DevEco Studio版本：DevEco Studio NEXT Developer Beta5及以上。
4. HarmonyOS SDK版本：HarmonyOS NEXT Developer Beta5 SDK及以上。
4. 双端设备需要登录同一华为账号。
5. 双端设备需要打开Wi-Fi和蓝牙开关。条件允许时，建议双端设备接入同一个局域网，可提升数据传输的速度。
6. 应用接续只能在同应用（UIAbility）之间触发，双端设备都需要有该应用。

### 相关概念
- 应用接续：应用接续，指当用户在一个设备上操作某个应用时，可以在另一个设备的同一个应用中快速切换，并无缝衔接上一个设备的应用体验。
- 分布式数据对象：提供管理基本数据对象的相关能力，同时支持相同应用多设备间的分布式数据对象协同能力。
- 分布式文件系统：分布式文件系统为应用提供了跨设备文件访问的能力。